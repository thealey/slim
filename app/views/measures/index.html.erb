<% floatformat = "%.2f" %>
<% floatformat_no_decimals = "%.0f" %>

<table>
  <tr>
    <td style="vertical-align:middle">
      <%= image_tag @person.gravatar_url %><br/>
      &nbsp;
      <%= @person.username %>
      <small>
        <table>
          <tr>
            <td>
              Goal of <strong><%= @person.goal.to_s +  @person.goal_type %></strong>.
              <p/><p/>
                  Trend in<br/>
                  3 months:<br/>
                  <strong><%= floatformat % @in3months if @in3months %></strong>.
                  <p/>
                    Karma rank: <strong><%= @karma_rank %></strong>
                  </td>
                </tr>
              </table>
            </small>
          </td>
          <td>
            <% if @lcurl7 %>
              <img src=<%= @lcurl7 %>/>
            <% end %>
          </td>
          <td>
            <% if @lcurl30 %>
              <img src=<%= @lcurl30 %>/>
            <% end %>
          </td>
          <td>
            <% if @lcurlall %>
              <img src=<%= @lcurlall %>/>
            <% end %>
          </td>
        </tr>
      </table>

      <p/>

        <table>
          <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th colspan='2'>Trend</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
          <tr>
            <th>#</th>
            <th>Weight</th>
            <th>Trend</th>
            <th>Karma *</th>
            <th>Fat %</th>
            <th>BMI</th>
            <th>Delta</th>
            <th>From goal</th>
            <th>User</th>
            <th>Measure Date</th>
            <th>Ago</th>
          </tr>
          <% counter = 1 %>
          <% for measure in @measures %>
            <tr>
              <td><%= counter %><% counter = counter + 1 %></td>
              <td><%= floatformat % measure.weight %></td>
              <td><%= floatformat % measure.trend if measure.trend %></td>
              <td><%= floatformat % measure.karma %></td>
              <td><%= floatformat % measure.fatpercentage if measure.fat %></td>
              <td><%= floatformat % @person.get_bmi(measure.trend) %></td>
              <td><%= '+' if measure.delta and measure.delta > 0 %><%= floatformat % measure.delta if measure.delta %></td>
              <% if @person.goal_type == 'lbs' %>
              <td><%= floatformat % (measure.trend - @person.goal) %></td>
            <% end %>
            <td><%= measure.person.username %></td>
            <td><%= measure.measure_date.to_s(:long) %></td>
            <td><%= time_ago_in_words(measure.measure_date) %></td>
            <% if logged_in? and current_person == @person %>
              <td><%= link_to "Edit", edit_measure_path(measure) %></td>
              <td><%= link_to "Destroy", measure, :confirm => 'Are you sure?', :method => :delete %></td>
            <% end %>
          </tr>
        <% end %>
      </table>
      <%= will_paginate @measures %>
      <small>  
        *Karma measures how effective is the trend towards the goal weight. 100 / top line of chart being the goal.
      </small>
      <p/>
